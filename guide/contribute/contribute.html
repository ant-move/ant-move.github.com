<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>介绍 | Antmove - 小程序转换器</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="https://cache.amap.com/ecology/tool/antmove/logo.png">
    <meta name="description" content="小程序转换器，轻量级小程序跨端解决方案">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.842ea349.css" as="style"><link rel="preload" href="/assets/js/app.b24cb1c1.js" as="script"><link rel="preload" href="/assets/js/2.360668ca.js" as="script"><link rel="preload" href="/assets/js/30.99a5b14a.js" as="script"><link rel="prefetch" href="/assets/js/10.189586fc.js"><link rel="prefetch" href="/assets/js/11.ca83c846.js"><link rel="prefetch" href="/assets/js/12.2e276302.js"><link rel="prefetch" href="/assets/js/13.7f748d5a.js"><link rel="prefetch" href="/assets/js/14.52575f60.js"><link rel="prefetch" href="/assets/js/15.3cd41abf.js"><link rel="prefetch" href="/assets/js/16.ca839621.js"><link rel="prefetch" href="/assets/js/17.8b3c08e5.js"><link rel="prefetch" href="/assets/js/18.22fb8554.js"><link rel="prefetch" href="/assets/js/19.2a566a74.js"><link rel="prefetch" href="/assets/js/20.98343508.js"><link rel="prefetch" href="/assets/js/21.cc77303f.js"><link rel="prefetch" href="/assets/js/22.cfb4e3a7.js"><link rel="prefetch" href="/assets/js/23.8aaacaf9.js"><link rel="prefetch" href="/assets/js/24.1f897d82.js"><link rel="prefetch" href="/assets/js/25.c7301817.js"><link rel="prefetch" href="/assets/js/26.5956c72e.js"><link rel="prefetch" href="/assets/js/27.3be75ef9.js"><link rel="prefetch" href="/assets/js/28.88a1be0b.js"><link rel="prefetch" href="/assets/js/29.bbd15d81.js"><link rel="prefetch" href="/assets/js/3.6bd71a22.js"><link rel="prefetch" href="/assets/js/31.fe9d0d2a.js"><link rel="prefetch" href="/assets/js/32.4fdbef76.js"><link rel="prefetch" href="/assets/js/33.309182a8.js"><link rel="prefetch" href="/assets/js/34.bc862a0a.js"><link rel="prefetch" href="/assets/js/35.476e2f3b.js"><link rel="prefetch" href="/assets/js/36.5f71166a.js"><link rel="prefetch" href="/assets/js/37.3a745bca.js"><link rel="prefetch" href="/assets/js/38.a1730877.js"><link rel="prefetch" href="/assets/js/39.18ca7571.js"><link rel="prefetch" href="/assets/js/4.3eb4e871.js"><link rel="prefetch" href="/assets/js/5.d47671f7.js"><link rel="prefetch" href="/assets/js/6.04568ca4.js"><link rel="prefetch" href="/assets/js/7.6b205a61.js"><link rel="prefetch" href="/assets/js/8.bcc6e7c3.js"><link rel="prefetch" href="/assets/js/9.47fd70d6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.842ea349.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://cache.amap.com/ecology/tool/antmove/logo.png" alt="Antmove - 小程序转换器" class="logo"> <span class="site-name can-hide">Antmove - 小程序转换器</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  指南
</a></div><div class="nav-item"><a href="/config/" class="nav-link">
  配置
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/amove/" class="nav-link">
  编译器
</a></div><div class="nav-item"><a href="/changelog/" class="nav-link">
  更新日志
</a></div><div class="nav-item"><a href="/blog/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="https://a.amap.com/antmove/static/data/treeTable.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  转换程度
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/ant-move/Antmove" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  指南
</a></div><div class="nav-item"><a href="/config/" class="nav-link">
  配置
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/amove/" class="nav-link">
  编译器
</a></div><div class="nav-item"><a href="/changelog/" class="nav-link">
  更新日志
</a></div><div class="nav-item"><a href="/blog/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="https://a.amap.com/antmove/static/data/treeTable.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  转换程度
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/ant-move/Antmove" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/contribute/contribute.html#介绍" class="sidebar-link">介绍</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guide/contribute/contribute.html#基础" class="sidebar-link">基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/contribute/contribute.html#基本原理" class="sidebar-link">基本原理</a></li><li class="sidebar-sub-header"><a href="/guide/contribute/contribute.html#文件结构对象-parsedir" class="sidebar-link">文件结构对象（parseDir）</a></li><li class="sidebar-sub-header"><a href="/guide/contribute/contribute.html#编译时文件对象" class="sidebar-link">编译时文件对象</a></li></ul></li><li><a href="/guide/contribute/contribute.html#项目结构" class="sidebar-link">项目结构</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/guide/contribute/contribute.html#实现原理" class="sidebar-link">实现原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/contribute/contribute.html#模板转换-wxml" class="sidebar-link">模板转换（wxml）</a></li><li class="sidebar-sub-header"><a href="/guide/contribute/contribute.html#逻辑转换-js" class="sidebar-link">逻辑转换（js）</a></li><li class="sidebar-sub-header"><a href="/guide/contribute/contribute.html#样式转换-wxss" class="sidebar-link">样式转换（wxss）</a></li><li class="sidebar-sub-header"><a href="/guide/contribute/contribute.html#配置文件转换-json" class="sidebar-link">配置文件转换（json）</a></li><li class="sidebar-sub-header"><a href="/guide/contribute/contribute.html#api-运行时处理" class="sidebar-link">API 运行时处理</a></li><li class="sidebar-sub-header"><a href="/guide/contribute/contribute.html#页面和自定义组件运行时处理" class="sidebar-link">页面和自定义组件运行时处理</a></li><li class="sidebar-sub-header"><a href="/guide/contribute/contribute.html#自定义封装组件处理-custom-map" class="sidebar-link">自定义封装组件处理（custom-map）</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p>Antmove - 小程序转换器，基于支付宝/微信小程序转换为多端小程序，让小程序跨平台开发变得简单。</p> <blockquote><p>一键实现小程序转换迁徙，不再为重复开发而烦恼。</p></blockquote> <h2 id="基础"><a href="#基础" class="header-anchor">#</a> 基础</h2> <p>Antmove并不是开发框架，准确的说是源码到源码的转换器。意思是向Antmove提供微信、支付宝等多端小程序的源码，通过Antmove转换为其他小程序。</p> <h3 id="基本原理"><a href="#基本原理" class="header-anchor">#</a> 基本原理</h3> <ul><li>Antmove转换小程序大致分为三个阶段，分别为转换前、转换中和转换后</li> <li>转换前，Antmove对小程序做了预处理，包括判断小程序的平台、使用者配置的开发环境、判断转换的完整小程序还是组件维度等。</li> <li>转换中，Antmove对模版，样式，Json，Js等文件进行处理，以达到跨平台开发的目的。</li> <li>转换后，在转换后的文件中生成_antmove文件，该文件中包含对API、组件、生命周期的差异支持和抹平。</li></ul> <h3 id="文件结构对象-parsedir"><a href="#文件结构对象-parsedir" class="header-anchor">#</a> 文件结构对象（parseDir）</h3> <ul><li>介绍</li></ul> <blockquote><p>在解析项目时会使用到一个文件结构对象fileInfo，上面记录了文件路径、文件名称、文件结构等相关信息。</p></blockquote> <ul><li>对象字段说明</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 文件类型</span>
  <span class="token property">&quot;path&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;User/../UserLogin/login.wxml&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 文件路径</span>
  <span class="token property">&quot;filename&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;login.wxml&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 文件名称</span>
  <span class="token property">&quot;extname&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;.wxml&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 扩展名称</span>
  <span class="token property">&quot;dirname&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;User/../UserLogin&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 目录名称</span>
  <span class="token property">&quot;basename&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;UserLogin&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 基础名称</span>
  <span class="token property">&quot;children&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
  	<span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  	<span class="token property">&quot;path&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">//...</span>
    <span class="token comment">// 结构与外层相同</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;parent&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
  	<span class="token comment">// 结构与children相同</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;deep&quot;</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 相对小程序根目录的结构深度</span>
  <span class="token property">&quot;entry&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 输入路径</span>
  <span class="token property">&quot;dist&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 输出路径</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>如何使用（配合代码示例）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code></code></pre></div><ul><li>插件代码示例</li></ul> <h3 id="编译时文件对象"><a href="#编译时文件对象" class="header-anchor">#</a> 编译时文件对象</h3> <blockquote><p>在config里记录了组件、API、JSON配置、生命周期的描述文件。在Antmove编译时参照config中描述进行编译。同时根据描述制作了Antmove的官网文档等。</p></blockquote> <h4 id="组件描述对象"><a href="#组件描述对象" class="header-anchor">#</a> 组件描述对象</h4> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;componentName&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 组件</span>
  	<span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 组件名称</span>
    <span class="token property">&quot;url&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
  		<span class="token property">&quot;beforeUrl&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">//转换前平台该API参考网址</span>
		<span class="token property">&quot;afterUrl&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token comment">//转换后平台该API参考网址</span>
  	<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;desc&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span> <span class="token comment">// 组件描述</span>
    <span class="token property">&quot;props&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 属性</span>
    	<span class="token property">&quot;propName&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 属性名</span>
      	<span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 支持差异（值与API描述对象的支持差异相同） </span>
        <span class="token property">&quot;status&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 支持程度</span>
        <span class="token property">&quot;desc&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token comment">// 属性描述</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="api-描述对象"><a href="#api-描述对象" class="header-anchor">#</a> API 描述对象</h4> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;apiName (api名称)&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;status (支持程度)&quot;</span> <span class="token operator">:</span> <span class="token punctuation">,</span><span class="token comment">// 0 - 完整支持 / 1 - 部分支持 / 2 - 不支持</span>
		<span class="token property">&quot;desc (api的描述)&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span>
		<span class="token property">&quot;url&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;beforeUrl&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;转换前平台该API参考网址&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;afterUrl&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;转换后平台该API参考网址&quot;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;body&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;msg&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;api抹平描述信息&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;returnValue (返回值)&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;props&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token property">&quot;returnValueName (返回值名称)&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
						<span class="token property">&quot;type (支持差异)&quot;</span> <span class="token operator">:</span> 
            						 <span class="token comment">/**0 - missing - 不支持该属性/
 										1 - diff - 命名格式说明/
  										3 - difftype - 类型不同/
  										4 - defaultValue - 默认值不同/
  										5 - wrapComponent - 使用自定义组件/
  										6 - diff tagName/
  										7 - equal - 完全支持*/</span>  <span class="token punctuation">,</span>
						<span class="token property">&quot;desc&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;返回值描述信息&quot;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token property">&quot;params (入参)&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token comment">/**
				结构与返回值相同
				*/</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="json-配置描述对象"><a href="#json-配置描述对象" class="header-anchor">#</a> json 配置描述对象</h4> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;JSONName&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 配置</span>
  	<span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 配置名称</span>
    <span class="token property">&quot;url&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
  		<span class="token property">&quot;beforeUrl&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">//转换前平台该API参考网址</span>
		<span class="token property">&quot;afterUrl&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token comment">//转换后平台该API参考网址</span>
  	<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;desc&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span> <span class="token comment">// 配置描述</span>
    <span class="token property">&quot;props&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 属性</span>
    	<span class="token property">&quot;propName&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 属性名</span>
      	<span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 支持差异（值与API描述对象的支持差异相同） </span>
        <span class="token property">&quot;status&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 支持程度</span>
        <span class="token property">&quot;desc&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token comment">// 属性描述</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="app-page-component-描述对象"><a href="#app-page-component-描述对象" class="header-anchor">#</a> App/Page/Component 描述对象</h4> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;lifeName (生命周期名称)&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;status (支持程度)&quot;</span> <span class="token operator">:</span> <span class="token punctuation">,</span><span class="token comment">//0 - 完整支持 / 1 - 部分支持 / 2 - 不支持</span>
		<span class="token property">&quot;desc (api的描述)&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">,</span>
		<span class="token property">&quot;url&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;beforeUrl&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;转换前平台该API参考网址&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;afterUrl&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;转换后平台该API参考网址&quot;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;body&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;msg&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;api抹平描述信息&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;returnValue (返回值)&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;props&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token property">&quot;returnValueName (返回值名称)&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
						<span class="token property">&quot;type (支持差异)&quot;</span> <span class="token operator">:</span> 
            						 <span class="token comment">/**0 - missing - 不支持该属性/
 										1 - diff - 命名格式说明/
  										3 - difftype - 类型不同/
  										4 - defaultValue - 默认值不同/
  										5 - wrapComponent - 使用自定义组件/
  										6 - diff tagName/
  										7 - equal - 完全支持*/</span>  <span class="token punctuation">,</span>
						<span class="token property">&quot;desc&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;返回值描述信息&quot;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token property">&quot;params (入参)&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token comment">/**
				结构与返回值相同
				*/</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="项目结构"><a href="#项目结构" class="header-anchor">#</a> 项目结构</h2> <ul><li>bin &gt; 定义和使用Antmove的配置</li> <li>src &gt; Antmove工具入口文件</li> <li>packages/@antmove &gt; 包含wx-alipay在内的各转换工具集合
<ul><li>wx-aipay-plugin &gt; 微信平台转支付宝平台工具
<ul><li>__api &gt; 对API能力的支持和抹平</li> <li>__component &gt; 抹平部分微信端支持但支付宝端不支持的组件/框架接口的处理
<ul><li>classSubdirectory &gt; 框架接口的处理
<ul><li>app.js &gt; 对小程序App的处理</li> <li>page.js &gt; 对页面的处理</li> <li>componnet.js &gt; 对自定义组件的处理</li></ul></li> <li>config &gt; 小程序平台差异的配置文件</li> <li>generate &gt; 转换中对源码处理并生成文件</li> <li>lifeCircles &gt; 小程序转换主要文件，对'.wxml'、'.wxss'、'.js'、'.json'、'.wxs'等文件进行转换处理</li></ul></li></ul></li> <li>utils &gt; 各转换工具的公共工具集合</li></ul></li></ul> <h2 id="实现原理"><a href="#实现原理" class="header-anchor">#</a> 实现原理</h2> <h3 id="模板转换-wxml"><a href="#模板转换-wxml" class="header-anchor">#</a> 模板转换（wxml）</h3> <ul><li>介绍</li></ul> <blockquote><p>Antmove在转换模版时会进行替换扩展名、检测wxs、处理标签、处理标签属性等步骤。</p></blockquote> <ul><li>原理说明</li></ul> <blockquote><p>Antmove会在编译时先替换源码模版的扩展名，之后会检测模版中引用的wxs模块转换成支付宝端支持的sjs文件进而引用。当然双端模版标签属性会有不同，Antmove会对标签进行过滤，下面会看到代码示例。</p></blockquote> <ul><li>代码示例</li></ul> <div class="language-js extra-class"><pre class="language-js"><code></code></pre></div><ul><li>插件代码索引（github 代码链接）</li></ul> <blockquote><p>https://github.com/ant-move/Antmove/blob/master</p></blockquote> <h3 id="逻辑转换-js"><a href="#逻辑转换-js" class="header-anchor">#</a> 逻辑转换（js）</h3> <ul><li>介绍</li></ul> <blockquote><p>Antmove对各级接口进行过滤。同时在js文件我们经常会使用到基础库提供的API，Antmove在编译时会在js文件引入‘__antmove/api/index’，该文件提供了经过过滤的api来抹平跨平台差异。</p></blockquote> <ul><li>原理说明</li></ul> <blockquote><p>在编译时Antmove在各级接口引入'__antmove/component/componentClass.js',对接口对象进行了过滤处理。意思是将接口对象传到我们的过滤工具中，通过我们的工具对生命周期、api、函数、接口对象等进行支持和抹平。</p></blockquote> <ul><li>代码示例</li></ul> <div class="language-js extra-class"><pre class="language-js"><code></code></pre></div><ul><li>插件代码索引</li></ul> <blockquote><p>https://github.com/ant-move/Antmove/blob/master/packages/%40antmove/wx-alipay-plugin/lifeCycles/compile/compileJs.js</p></blockquote> <h3 id="样式转换-wxss"><a href="#样式转换-wxss" class="header-anchor">#</a> 样式转换（wxss）</h3> <ul><li>介绍</li></ul> <blockquote><p>Antmove在过滤样式文件时，最大可能的保持了文件的原貌。当然我们也要注意，当从微信转到支付宝时不要使用属性选择器，支付宝端并不支持属性选择器。</p></blockquote> <ul><li>原理说明</li></ul> <blockquote><p>Antmove在改掉文件后缀名（wxss改为acss）后，当判断存在引入的外部样式时会把‘@import’的路径改为支付宝可以识别的路径样式。转换后的app.acss文件还会引入一个全局样式@import  &quot;/__antmove/static/app.acss&quot;。</p></blockquote> <ul><li>代码示例</li></ul> <div class="language-js extra-class"><pre class="language-js"><code></code></pre></div><ul><li>插件代码索引</li></ul> <blockquote><p>https://github.com/ant-move/Antmove/blob/master/packages/%40antmove/wx-alipay-plugin/lifeCycles/compile/compileWxss.js</p></blockquote> <h3 id="配置文件转换-json"><a href="#配置文件转换-json" class="header-anchor">#</a> 配置文件转换（json）</h3> <ul><li>介绍</li></ul> <blockquote><p>对于json我们主要对配置做了处理，转换成了支付宝小程序可识别的配置。</p></blockquote> <ul><li>原理说明</li></ul> <blockquote><p>Antmove利用编译时文件对象进行配置名称的替换，同时对usingComponents的路径进行了处理。</p></blockquote> <ul><li>代码示例</li></ul> <div class="language-js extra-class"><pre class="language-js"><code></code></pre></div><ul><li>插件代码索引</li></ul> <blockquote><p>https://github.com/ant-move/Antmove/blob/master/packages/%40antmove/wx-alipay-plugin/lifeCycles/index.js</p></blockquote> <h3 id="api-运行时处理"><a href="#api-运行时处理" class="header-anchor">#</a> API 运行时处理</h3> <ul><li>介绍</li></ul> <blockquote><p>在小程序中，我们时一定会用到提供的API。但可使用的开放能力和API命名等都有所不同。Antmove利用过滤文件进行了支持与抹平</p></blockquote> <ul><li>原理说明
在用到api的脚本，Antmove会引入‘const _my =reqiure(&quot;/_antmove/api/index.js&quot;)’，引入文件对所用到的api做了过滤处理，当用到支付宝端不支持的api或者api属性、返回值等，Antmove都会进行警告等处理。原本的 ‘_my.xxx’ 相当于 ‘my.xxx’ 。</li> <li>代码示例</li></ul> <div class="language-js extra-class"><pre class="language-js"><code></code></pre></div><ul><li>插件代码索引</li></ul> <blockquote><p>https://github.com/ant-move/Antmove/tree/master/packages/%40antmove/wx-alipay-plugin/__api</p></blockquote> <h3 id="页面和自定义组件运行时处理"><a href="#页面和自定义组件运行时处理" class="header-anchor">#</a> 页面和自定义组件运行时处理</h3> <ul><li>介绍</li></ul> <blockquote><p>Antmove对组件、页面、全局的接口对象进行了转换，对生命周期、事件、observer、relations、behavior等进行了支持和抹平</p></blockquote> <ul><li>原理说明</li></ul> <blockquote><p>在编译时，Antmove对各js文件进行甄别，确定各级接口分别引入接口对应的过滤文件。在运行时，过滤文件和把接口对象中的各个对象进行处理，在页面渲染前会对behavior，relations等进行预处理。之后会对各生命周期用到的功能进行支持和抹平。</p></blockquote> <ul><li>代码示例</li></ul> <div class="language-js extra-class"><pre class="language-js"><code></code></pre></div><ul><li>插件代码索引</li></ul> <blockquote><p>https://github.com/ant-move/Antmove/blob/master/packages/%40antmove/wx-alipay-plugin/__component/componentClass.js</p></blockquote> <h3 id="自定义封装组件处理-custom-map"><a href="#自定义封装组件处理-custom-map" class="header-anchor">#</a> 自定义封装组件处理（custom-map）</h3> <ul><li>介绍</li></ul> <blockquote><p>平台间的组件能力也有差别，例如map组件。Antmove选择自定义封装组件custom-map来处理类似问题。</p></blockquote> <ul><li>原理说明</li></ul> <blockquote><p>组件不支持的属性和返回值会利用api和自定义逻辑来抹平，如果开放能力不允许会进行警告等处理方式。</p></blockquote> <ul><li>代码示例</li></ul> <div class="language-js extra-class"><pre class="language-js"><code></code></pre></div><ul><li>插件代码索引</li></ul> <blockquote><p>https://github.com/ant-move/Antmove/tree/master/packages/%40antmove/wx-alipay-plugin/component</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.b24cb1c1.js" defer></script><script src="/assets/js/2.360668ca.js" defer></script><script src="/assets/js/30.99a5b14a.js" defer></script>
  </body>
</html>
